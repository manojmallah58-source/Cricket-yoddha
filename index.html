<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
<meta name="referrer" content="no-referrer">
<title>Cricket Yoddha | Live</title>

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/plyr@3.7.8/dist/plyr.css" />
<script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
<script src="https://cdn.jsdelivr.net/npm/plyr@3.7.8/dist/plyr.polyfilled.js"></script>

<style>
  html, body {
    margin: 0; padding: 0; height: 100%; width: 100%;
    background-color: #000;
    display: flex; justify-content: center; align-items: center;
    overflow: hidden;
  }

  #player-container {
    width: 100%;
    max-width: 1000px;
    height: auto;
    position: relative;
  }

  /* Full screen response */
  .video-wrapper {
    width: 100%;
    aspect-ratio: 16 / 9;
  }

  /* Screenshot Button Design */
  .plyr__control--screenshot svg {
    width: 20px !important;
    height: 20px !important;
  }

  /* Fast Load Red Theme */
  .plyr--full-ui {
    --plyr-color-main: #ff0000;
  }

  /* Hide helper canvas */
  #canvas-capture { display: none; }
</style>
</head>
<body>

<div id="player-container">
  <div class="video-wrapper">
    <video id="plyr-player" controls playsinline crossorigin="anonymous"></video>
  </div>
</div>

<canvas id="canvas-capture"></canvas>

<script>
  const video = document.getElementById('plyr-player');
  const canvas = document.getElementById('canvas-capture');

  // URL extraction
  const m3u8Url = new URLSearchParams(window.location.search).get('url');

  if (m3u8Url) {
    if (Hls.isSupported()) {
      const hls = new Hls({
        capLevelToPlayerSize: true,
        enableWorker: true,
        lowLatencyMode: true,
        backBufferLength: 30
      });
      hls.loadSource(m3u8Url);
      hls.attachMedia(video);
      hls.on(Hls.Events.MANIFEST_PARSED, () => setupPlayer());
    } else {
      video.src = m3u8Url;
      setupPlayer();
    }
  }

  function setupPlayer() {
    const player = new Plyr(video, {
      autoplay: true,
      settings: ['quality', 'speed'],
      controls: ['play-large', 'play', 'progress', 'current-time', 'mute', 'volume', 'settings', 'fullscreen']
    });

    // Button Injection Logic
    player.on('ready', () => {
      const controlBar = document.querySelector('.plyr__controls');
      const settingsBtn = document.querySelector('[data-plyr="settings"]');
      
      if (controlBar && settingsBtn && !document.querySelector('.plyr__control--screenshot')) {
        const ssBtn = document.createElement('button');
        ssBtn.type = 'button';
        ssBtn.className = 'plyr__control plyr__control--screenshot';
        ssBtn.setAttribute('aria-label', 'Take Screenshot');
        ssBtn.innerHTML = `
          <svg viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2">
            <path d="M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z"></path>
            <circle cx="12" cy="13" r="4"></circle>
          </svg>`;
        
        // Settings ke theek baju mein lagana
        settingsBtn.before(ssBtn);

        ssBtn.onclick = () => {
          canvas.width = video.videoWidth;
          canvas.height = video.videoHeight;
          const ctx = canvas.getContext('2d');
          try {
            ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
            const link = document.createElement('a');
            link.download = `CricketYoddha_${Date.now()}.png`;
            link.href = canvas.toDataURL('image/png');
            link.click();
          } catch(e) { 
            alert("Security Error: Link provider screenshots block kar raha hai."); 
          }
        };
      }
    });
  }

  // Fullscreen Landscape Mode
  document.addEventListener('fullscreenchange', () => {
    if (document.fullscreenElement) {
      if(screen.orientation && screen.orientation.lock) {
        screen.orientation.lock('landscape').catch(() => {});
      }
    } else {
      if(screen.orientation && screen.orientation.unlock) {
        screen.orientation.unlock();
      }
    }
  });
</script>

</body>
</html>
