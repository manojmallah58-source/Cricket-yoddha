<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
<meta name="referrer" content="no-referrer">
<title>Cricket Yoddha | Premium</title>

<link rel="preconnect" href="https://cdn.jsdelivr.net">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/plyr@3.7.8/dist/plyr.css" />

<style>
  /* Premium Dark Theme */
  :root {
    --plyr-color-main: #ff0000;
    --player-bg: #000;
  }

  html, body {
    margin: 0; padding: 0; height: 100%; width: 100%;
    background: var(--player-bg);
    display: flex; justify-content: center; align-items: center;
    overflow: hidden;
    font-family: 'Inter', -apple-system, sans-serif;
  }

  #player-container {
    width: 100%;
    max-width: 100%;
    box-shadow: 0 20px 50px rgba(0,0,0,0.5);
    background: #000;
  }

  /* Aspect Ratio 16:9 for Mobile Centering */
  .plyr {
    width: 100%;
    aspect-ratio: 16 / 9;
    border-radius: 0px;
  }

  /* Glassmorphism Controls */
  .plyr__controls {
    background: linear-gradient(rgba(0,0,0,0), rgba(0,0,0,0.8)) !important;
    padding: 20px 10px 10px !important;
  }

  /* Screenshot Button Styling */
  .plyr__control--screenshot svg {
    width: 19px !important;
    height: 19px !important;
    transition: transform 0.2s ease;
  }

  .plyr__control--screenshot:active svg {
    transform: scale(0.8);
  }

  /* Hidden Canvas */
  #canvas-capture { display: none; }

  /* Loading Spinner Unique Design */
  .plyr--loading::after {
    border-color: var(--plyr-color-main) transparent transparent !important;
  }
</style>
</head>
<body>

<div id="player-container">
  <video id="plyr-player" controls playsinline crossorigin="anonymous"></video>
</div>

<canvas id="canvas-capture"></canvas>

<script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
<script src="https://cdn.jsdelivr.net/npm/plyr@3.7.8/dist/plyr.polyfilled.js"></script>

<script>
  const video = document.getElementById('plyr-player');
  const canvas = document.getElementById('canvas-capture');
  const urlParam = new URLSearchParams(window.location.search).get('url');

  // --- Optimization: Fast HLS Loading ---
  if (urlParam) {
    if (Hls.isSupported()) {
      const hls = new Hls({
        debug: false,
        enableWorker: true,
        lowLatencyMode: true,
        backBufferLength: 90, // Better buffering
        capLevelToPlayerSize: true
      });
      hls.loadSource(urlParam);
      hls.attachMedia(video);
      hls.on(Hls.Events.MANIFEST_PARSED, () => initPlyr());
    } else {
      video.src = urlParam;
      initPlyr();
    }
  }

  function initPlyr() {
    const player = new Plyr(video, {
      autoplay: true,
      quality: { default: 720, options: [1080, 720, 480, 360] },
      controls: [
        'play-large', 'play', 'progress', 'current-time', 
        'mute', 'volume', 'settings', 'fullscreen'
      ],
      tooltips: { controls: true, seek: true }
    });

    // --- Inject Screenshot Button near Settings ---
    player.on('ready', () => {
      const controlBar = document.querySelector('.plyr__controls');
      const settingsBtn = document.querySelector('[data-plyr="settings"]');

      if (settingsBtn && !document.querySelector('.plyr__control--screenshot')) {
        const ssBtn = document.createElement('button');
        ssBtn.type = 'button';
        ssBtn.className = 'plyr__control plyr__control--screenshot';
        ssBtn.setAttribute('data-plyr', 'screenshot');
        ssBtn.innerHTML = `
          <svg viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2.5">
            <path d="M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z"></path>
            <circle cx="12" cy="13" r="4"></circle>
          </svg>`;
        
        // Placement: Just before settings gear icon
        settingsBtn.before(ssBtn);

        ssBtn.onclick = () => {
          canvas.width = video.videoWidth;
          canvas.height = video.videoHeight;
          const ctx = canvas.getContext('2d');
          try {
            ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
            const dataUrl = canvas.toDataURL('image/png');
            const link = document.createElement('a');
            link.download = `CricketYoddha_SS_${Date.now()}.png`;
            link.href = dataUrl;
            link.click();
          } catch(e) {
            alert("Error: Video Security (CORS) blocked screenshot.");
          }
        };
      }
    });
  }

  // --- Advance Screen Orientation Logic ---
  const handleOrientation = () => {
    if (document.fullscreenElement) {
      if (screen.orientation && screen.orientation.lock) {
        screen.orientation.lock('landscape').catch(() => {});
      }
    } else {
      if (screen.orientation && screen.orientation.unlock) {
        screen.orientation.unlock();
      }
    }
  };

  document.addEventListener('fullscreenchange', handleOrientation);
</script>

</body>
</html>
