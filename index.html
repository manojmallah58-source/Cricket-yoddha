<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="referrer" content="no-referrer">
    <title>Pro Video Player v2.0</title>

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/plyr@3.7.8/dist/plyr.css" />
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <script src="https://cdn.jsdelivr.net/npm/plyr@3.7.8/dist/plyr.polyfilled.js"></script>

    <style>
        :root {
            --plyr-color-main: #ffb400; /* Screenshot Matching Yellow */
            --plyr-video-background: #000;
        }

        body, html {
            margin: 0; padding: 0;
            width: 100%; height: 100%;
            background-color: #000;
            display: flex; align-items: center; justify-content: center;
            overflow: hidden;
        }

        .player-container {
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
        }

        /* Screenshot style controls */
        .plyr__controls {
            background: linear-gradient(transparent, rgba(0, 0, 0, 0.9)) !important;
            padding: 25px 15px 15px !important;
        }

        /* Quality selector styling */
        .plyr__menu__container {
            background: rgba(26, 26, 26, 0.95) !important;
            border-radius: 8px !important;
        }

        video { object-fit: contain; }
    </style>
</head>
<body>

<div class="player-container">
    <video id="player" playsinline crossorigin="anonymous"></video>
</div>

<script>
    const video = document.getElementById('player');
    const source = new URLSearchParams(window.location.search).get('url');

    // Controls set as per screenshot + Quality options
    const defaultControls = [
        'play-large', 'play', 'progress', 'current-time', 
        'duration', 'mute', 'volume', 'settings', 'fullscreen'
    ];

    if (Hls.isSupported() && source) {
        const hls = new Hls();
        hls.loadSource(source);
        hls.attachMedia(video);

        hls.on(Hls.Events.MANIFEST_PARSED, function () {
            // Quality levels detect karna
            const availableQualities = hls.levels.map(l => l.height);
            availableQualities.unshift(0); // Add 'Auto' option

            const player = new Plyr(video, {
                controls: defaultControls,
                settings: ['quality', 'speed'],
                quality: {
                    default: 0, // Auto
                    options: availableQualities,
                    forced: true,
                    onChange: (newQuality) => {
                        if (newQuality === 0) {
                            hls.currentLevel = -1; // Auto quality
                        } else {
                            hls.levels.forEach((level, levelIndex) => {
                                if (level.height === newQuality) {
                                    hls.currentLevel = levelIndex;
                                }
                            });
                        }
                    }
                },
                i18n: { quality: 'Quality', auto: 'Auto' }
            });

            // Camera (Screenshot) Button logic
            addScreenshotButton(player);
        });

        window.hls = hls;
    } else {
        // Safari/iOS native fallback
        video.src = source;
        new Plyr(video, { controls: defaultControls });
    }

    function addScreenshotButton(player) {
        const controlBar = document.querySelector('.plyr__controls');
        const camBtn = document.createElement('button');
        camBtn.type = 'button';
        camBtn.className = 'plyr__control';
        camBtn.style.padding = '10px';
        camBtn.innerHTML = `
            <svg viewBox="0 0 24 24" width="22" height="22" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z"></path>
                <circle cx="12" cy="13" r="4"></circle>
            </svg>`;
        
        camBtn.onclick = () => {
            try {
                const canvas = document.createElement('canvas');
                canvas.width = video.videoWidth;
                canvas.height = video.videoHeight;
                canvas.getContext('2d').drawImage(video, 0, 0);
                const link = document.createElement('a');
                link.download = `Live_Shot_${new Date().getTime()}.png`;
                link.href = canvas.toDataURL('image/png');
                link.click();
            } catch (e) {
                alert("Screenshot error: Cross-origin restriction.");
            }
        };

        const settingsBtn = controlBar.querySelector('[data-plyr="settings"]');
        controlBar.insertBefore(camBtn, settingsBtn);
    }
</script>

</body>
</html>

